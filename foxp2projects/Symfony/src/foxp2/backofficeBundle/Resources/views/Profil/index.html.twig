{# \Symfony\src\foxp2\backofficeBundle\Resources\views\Profil\index.html.twig #}
{% extends "foxp2backofficeBundle:Common:layout_admin.html.twig" %}
{% block application -%}
        <div class="win-ui-dark progress hide" id="progressouter" style="background-image: url({{ asset("bundles/foxp2backoffice/images/bkg-4.png") }}"> 
            <h3 class="text-info text-center"><strong></strong></h3><br />
            <div class="bar" id="progress" style="max-height: 50px;"></div>
        </div>
        <div id="nav-bar">
            <div class="row">
                <div class="span9">
                    <div id="header-container">
                        <a id="backbutton" class="win-backbutton" style="margin-right: 10px;" href="{{ path('foxp2backoffice_homepage')}}"></a>
                        <div class="dropdown pull-right">
                            <h1 class="header-dropdown">{{ 'Profil of'|trans }} {{profil_github_name}}</h1>
                        </div>
                    </div>
                </div>
                {% include "foxp2backofficeBundle:Secured:logout.html.twig" %}
            </div>
        </div>
<div class="row-fluid">
        <form id="profil_search" class="form-inline pull-right" action="{{ path('profil_index') }}" method="post" {{ form_enctype(form_search) }}>
            <div class="btn-group" style="z-index:1">
            {% if keyword != '' %}
            <a class="btn" href="{{ path('profil_index') }}" title=""><i class="icon-refresh"></i></a>
            {% endif %}
            {% if results is defined and results|length > 1 %}
                <input id="search" name="search" type="text" class="input-large" style="height:30px;" value="{{keyword}}">           
                <select id="searchpulldown">
                        <option value="" disabled>{{ 'The %s first others results'|trans|format(results|length) }} :</option>
                {% for result in results %}
                        <option value="{{ result }}" {% if profil_github_name == result %}selected="selected"{% endif %}>{{ result }}</option>
                {% endfor %}
                </select>
            {% else %}
            <input id="search" type="text" name="search" class="input-large" style="height:30px;" placeholder="{{ 'Search a profil'|trans }}" {% if keyword != '' %}value="{{ keyword }}"{% endif %}/>
            {% endif %}
            <button class="btn btn-primary" type="submit"><i class="icon-search"></i></button>
            </div>
        </form>
        {% if user_exist != false %}
        <div class="alert alert-block alert-danger">
            <button type="button" class="close" data-dismiss="alert"></button>
            <h4>{{ 'error'|trans }} !</h4>
            <p id="error"></p>
        </div>
        <div id="pivot" class="pivot slide text-center">
            <div class="pivot-headers">
                <a href="#pivot" data-pivot-index="0" class="active"><i class="github-untitled-9"></i> {{ 'Profil'|trans }}</a>
                <a href="#pivot" data-pivot-index="1"><i class="github-untitled-52"></i> {{ 'Activities'|trans }}</a>
                <a href="#pivot" data-pivot-index="2"><i class="github-untitled-160"></i> {{ 'Publics repos'|trans }}</a>
                <a href="#pivot" data-pivot-index="3"><i class="github-untitled-14"></i> {{ 'Publics gists'|trans }}</a>
            </div>

        <div class="pivot-items">
        <!-- profil -->
        <div id="pivot-item-1" class="pivot-item active">
            <h2 class="text-left" style="color:#377C89"><strong>{{ 'Public profil'|trans }}</strong></h2><hr>
            <div class="row-fluid">
                <div class="span9" id="leftprofil">
                        <ul id="profiltab" class="nav nav-tabs">
                            <li class="active"><a href="#starred" data-toggle="tab"><h3 style="color:#377C89"><i class="github-untitled-42"></i>{{ 'Starred by'|trans }} {{ profil_github_name}}</h3></a></li>
                            <li><a href="#following" data-toggle="tab"><h3 style="color:#377C89"><i class="github-untitled-28"></i> {{ 'Following by'|trans }} {{ profil_github_name}}</h3></a></li>
                            <li><a href="#followers" data-toggle="tab"><h3 style="color:#377C89"><i class="github-untitled-24"></i> {{ 'Followers of'|trans }} {{ profil_github_name}}</h3></a></li>
                        </ul>
                        <div id="myTabContent" class="tab-content">
                            <div class="tab-pane fade active in" id="starred" style="overflow-x:hidden;overflow-y:hidden">
                                <div class="listview grid-layout text-left" id="starred-list"></div>
                            </div>
                            <div class="tab-pane fade" id="following" style="overflow-x:hidden;overflow-y:hidden">
                                <div class="listview grid-layout text-left" id="following-list"></div>
                            </div>
                            <div class="tab-pane fade" id="followers" style="overflow-x:hidden;overflow-y:hidden">
                                <div class="listview grid-layout text-left" id="followers-list"></div>
                            </div>
                        </div>
                </div>
            <div class="span3 text-left" id="rightprofil">
                        <h3 class="text-center">{{ 'Detail of repo'|trans }}</h3>
                        <hr>
                        <div class="well well-kaki text-center" style="margin-top:30px;margin-left: -20px;">
                            <div id="rightprofildata"></div>
                            <div id="rightprofilinfo">
                                 <h3>{{ 'Click on a repository in the list below for more information'|trans }}</h3>
                            <h1 class="text-center" style="color:#377C89;margin-top:200px;"><i class="icon-arrow-left-5"></i></h1>
                            </div>
                        </div>
            </div>
            </div>
        </div>
        <!-- activités -->
        <div id="pivot-item-2" class="pivot-item">
            <h2 class="text-left" style="color:#F09609"><strong>{{ 'The latest recent activities'|trans }} :</strong></h2><hr>
            <div class="row-fluid">
                <div class="span9">
                    <div id="data-activities" class="listview grid-layout text-left" style="max-height: 600px;"></div>
                </div>
                <div class="span3 pull-right">
                    <div class="well well-orange" style="min-height:600px;margin-right:20px;margin-left: -20px;margin-top:16px;">
                        <div id="data-activityid">
                            <h3>{{ 'Click on an activity in the list below for more information'|trans }}</h3>
                            <h1 class="text-center" style="color:#F09609;margin-top:200px;"><i class="icon-arrow-left-5"></i></h1>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- dépôts -->
        <div id="pivot-item-3" class="pivot-item">
            <h2 class="text-left" style="color:#2C83EF;"><strong>{{ 'Publics repos'|trans }}</strong></h2><hr>
            <div class="row-fluid">
                <div class="span9">
                <div id="data-repositories" class="listview grid-layout text-left" style="max-height: 600px;"></div>
                </div>
                <div class="span3 pull-right">
                    <div class="well well-blue" style="min-height:600px;margin-right:20px;margin-left: -20px;margin-top:16px;">
                        <div id="data-repository">
                            <h3>{{ 'Click on a repository in the list below for more information'|trans }}</h3>
                            <h1 class="text-center" style="color:#2C83EF;margin-top:200px;"><i class="icon-arrow-left-5"></i></h1>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- gists -->
        <div id="pivot-item-4" class="pivot-item">
            <h2 class="text-left" style="color:#7B4F9D"><strong>{{ 'Publics gists'|trans }}</strong></h2><hr>
            <div class="row-fluid" id="gistresult">
                <div class="span3">
                <div class="listview list-layout text-left" id="gists-list" style="max-height:600px;"></div>
                </div>
                <div class="span9 pull-right text-left">
                <div id="gistdetail" style="margin-top: 7px; margin-right:20px;">
                    <div class="hero-unit" style="background-color:transparent;text-align:left;">
                        <h1>{{ 'loading files'|trans }}</h1>
                        <hr>
                             <p>
                                 <strong>{{ 'Please select a gist from the list below to get all source code hosted on Github servers'|trans }}</strong>
                                 <br /><br />
                                 <em>{{ 'Please note: The data are cached'|trans }}</em>
                             </p>
                    </div>
                </div>
                </div>
            </div>
        </div>
        </div><!-- end pivot-items -->
        </div><!-- end pivot -->
        {% else %}
        {% set flashbag_erreurs = app.session.flashbag.get('error') %}
        {% if flashbag_erreurs is not empty %}
            <div class="alert alert-danger" style="margin-top:40px;">
            <button type="button" class="close" data-dismiss="alert"></button>
            {% for message in flashbag_erreurs %}
                    {% if app.session.flashbag.has('keyword') %}
                    <strong>{{ message|trans|format(app.session.flashbag.get('keyword')[0]) }}</strong>
                    {% else %}
                    <strong>{{ message|trans|raw }}</strong>
                    {% endif %}
            {% endfor %}
            </div>
        {% endif %}
        {% endif %}
</div>

<div id="profil-footer" class="well well-profil-stat" style="margin-left: -20px;margin-top: 92px;"></div>
{% endblock %}
{% block appbar %}
<!-- app bar -->
<div id="app-bar" class="win-commandlayout win-ui-dark">
    <a class="win-command white pull-right" href="#">
        <span class="win-commandicon win-commandring github-untitled-24 icon-fox"></span>
        <span class="win-label white">{{ 'View this profil'|trans }}</span>
    </a>
</div>
<script>
$('.alert').hide();
jQuery('#app-bar').animate({bottom: '-92px'},0);
activitystatus = false;
repositorystatus = false;
followingstatus = false;
followersstatus = false;
gistliststatus = false;
var keyword = null;
profil_selectd = null;
profil = '{{profil_github_name}}';
user_exist = '{{user_exist}}';
if(user_exist === "0" ){
    $('.alert').show();
    getlimit();
}else{
    getwatched();
}
$('#app-bar a').click(function(){
    $("#search" ).val(profil_selected);
    $('#profil_search').attr('action', '{{ path('profil_index') }}').unbind('submit').submit();  
});
$('#searchpulldown').change(function(){
    var str = "";    
    $("#search" ).val();
    $( "select option:selected" ).each(function() {
    str = $(this).text();
    $("#search" ).val(str);
    $('#profil_search').attr('action', '{{ path('profil_index') }}').unbind('submit').submit();    
});    
});
$('#profiltab li a').click(function(){
    $('.watched').removeClass('selected');
    $('.following').removeClass('selected'); 
    $('.followers').removeClass('selected');
    switch($(this).attr('href')) {
        case "#starred" :
            jQuery('#app-bar').animate({bottom: '-92px'},400);
            $('#starred-list').hide().fadeIn(1000);
            $('#rightprofildata').empty(); 
            $('#rightprofilinfo').show(); 
            $('#rightprofil h3:first').text('{{ 'Detail of repo'|trans|escape('js') }}'); 
            $('#rightprofil h3:last').text('{{ 'Click on a repository in the list below for more information'|trans|escape('js') }}');
            break;
        case "#following":
            jQuery('#app-bar').animate({bottom: '-92px'},400);
            cleanprofil();
            if(followingstatus === true) {                
                 $('#following-list').hide().fadeIn(1000);                 
                 }else{ 
                 getfollowing();                 
            }
             break;
        case "#followers":
            jQuery('#app-bar').animate({bottom: '-92px'},400);
            cleanprofil();
            if(followersstatus === true) {                
                $('#followers-list').hide().fadeIn(1000);                
            }else{ 
                getfollowers();
                
            }
            break;
    }
});
function cleanprofil() {
$('#rightprofildata').empty(); 
$('#rightprofilinfo').show();
$('#rightprofil h3:first').text('{{ 'Profil detail'|trans|escape('js') }}');
$('#rightprofil h3:last').text('{{ 'Click on a developer in the list below to get more against information'|trans|escape('js') }}');
}
$('.pivot-headers a').click(function(){
    switch($(this).attr('data-pivot-index')){
        case "0": 
            $('#starred-list').hide().fadeIn(1000);
            $('#rightprofil').hide().fadeIn(1000);
        break;
        case "1": 
            jQuery('#app-bar').animate({bottom: '-92px'},400); 
            cleanprofil();   
            $('.watched').removeClass('selected');
            $('.following').removeClass('selected'); 
            $('.followers').removeClass('selected'); 
            (activitystatus === true) ? $('#data-activities').hide().fadeIn(1000) : getactivities(); 
        break;
        case "2": 
            jQuery('#app-bar').animate({bottom: '-92px'},400);
            cleanprofil();   
            $('.watched').removeClass('selected');
            $('.following').removeClass('selected'); 
            $('.followers').removeClass('selected'); 
            (repositorystatus === true) ? $('#data-repositories').hide().fadeIn(1000) : getrepositories();
        break;
        case "3": 
            jQuery('#app-bar').animate({bottom: '-92px'},400);
            cleanprofil();   
            $('.watched').removeClass('selected');
            $('.following').removeClass('selected'); 
            $('.followers').removeClass('selected'); 
            (gistliststatus === true) ? $('#gists-list').hide().fadeIn(1000) : getgists();
        break;
    }
});
function getlimit() {
    $.ajax({
        type: 'POST',
        datatype: 'json',
        url: '{{ path('profil_limit')}}',
        success: function(response) {
        $("#progressouter").addClass("hide");
        $("#progress").css('width','0%');
        $('#profil-footer').empty();
        $('#profil-footer').append('<p class="text-center">\n\
                                    <strong>{{ 'Statistics Queries on Github server'|trans }} : </strong> \n\
                                    - {{ 'Number of requests'|trans }} : <strong><em>'+response['rate']['limit']+'</em></strong> \n\
                                    - {{ 'Remaining number of requests'|trans }}: <strong><em>'+response['rate']['remaining']+'</em></strong></p>');
        },
        complete: function() {
        $('#profil-footer').removeClass('hide');
        },
        error: function(x,t,m) {
        $('#profil-footer-data').append('<p class="text-center">'+x+t+m+'</p>');
        $('#profil-footer').removeClass('hide');
        }
    });
}
function getActivity(name,id) {    
    $("#progressouter").removeClass("hide");
    $('#progressouter h3').text('{{ 'loading data ...'|trans }}');
    $.ajax({
        type: 'POST',
        dataType: 'json',
        url: '{{ path('activity_ajax',{name:'null','id':0})}}',        
        data: 'name='+name+'&id='+id,
        timeout: 10000,
        success: function(response) {               
        $('#data-activityid').append('<hr><h2 class="text-left"><i class="icon-feed"></i> Actions :<strong></h2>');
            for(var i=0; i<response.length;i++) { 
                if(response.length === 1 || response.length === 0){
                    $("#progress").css('width','100%');
                }else{
                    $("#progress").css('width',(i*100/i)+'%'); 
                }                   
                setTimeout(function () {
                    $('#progressouter h3').text(i*100/i+'%');
                },100);
                var obj = response[i];
                if ( obj['type'] === 'PushEvent') {
                $('#data-activityid').append('<ul class="nav nav-list text-left">\n\
                                              <li><i class="icon-user"></i> {{ 'Author'|trans }} : '+obj['author']+'</li>\n\
                                              <li><i class="icon-envelope"></i> {{ 'Email'|trans }} : '+obj['email']+'</li>\n\
                                              <li><i class="icon-comment"></i> {{ 'Comments'|trans }} : <br /><blockquote>'+obj['message']+'</blockquote></li>\n\
                                              <li class="divider"></li></ul><a class="btn" href="https://github.com/'+obj['repo']+'/commit/'+obj['sha']+'" target="_blank">{{ 'See on Github'|trans }}</a><br />');
                }
                if ( obj['type'] === 'WatchEvent') {
                $('#data-activityid').append('<ul class="nav nav-list text-left">\n\
                                              <li>{{ 'Action'|trans }} : '+obj['action']+'</li></ul>');
                }
                if ( obj['type'] === 'IssuesEvent') {
                $('#data-activityid').append('<ul class="nav nav-list text-left">\n\
                                              <li>{{ 'Action'|trans }} :'+obj['action']+'</li>\n\
                                              <li>{{ 'Status'|trans }} : '+obj['status']+'</li>\n\
                                              <li>{{ 'Title'|trans }} : '+obj['title']+'</li>\n\
                                              <li>{{ 'Description'|trans }} :</li><br />\n\
                                              <blockquote>'+obj['body']+'</blockquote></ul><hr><a class="btn" target="_blank" href="'+obj['link']+'">{{ 'See on Github'|trans }}</a>');
                }
                if ( obj['type'] === 'Undefined') {
                $('#data-activityid').append('<ul class="nav nav-list text-left"><li>{{ 'This activity is not listed yet by this application'|trans|escape('js') }}</li></ul>');
                }
            }
        },
        complete: function() {        
        getlimit();
        },
        error: function(x,t,m) {
            if ( t === 'timeout') {
                $('#error').empty();
                $('#error').append('{{ 'The request failed because the remote server took too long to respond'|trans }}');
                $('.alert').show();
                getlimit();
            } else {
               $('#error').empty();
               $('#error').append('<strong>'+t+'</strong> : '+m+x+'');
               $('.alert').removeClass('hide');
               getlimit();
            }
        }
    });
}
function getdevprofil(name) {
    $("#progressouter").removeClass("hide");
    $('#progressouter h3').text('{{ 'loading data ...'|trans }}');
    profil_selected = name;
    $.ajax({
        type: 'POST',
        dataType: 'json',
        url: '{{ path('profil_ajax',{'id':0}) }}',
        timeout: 10000,
        data: 'id=' + name,
        success: function(response) {     
        for(var i=0;i<response['size'];i++) {
          $("#progress").css('width',(i*100/i)+'%');
                setTimeout(function () {
                    $('#progressouter h3').text(i*100/i+'%');
                },100);
        }
          $('#rightprofildata').append('<h2 class="pull-left"><strong>'+response['login']+'</h2><img style="height:90px;width:90px;" class="pull-right img-polaroid" src="'+response['avatar_url']+'" alt="avatar">\n\
                                        <div class="clearfix"></div>'+response['name']+response['bio']+'<hr><h3 class="media-heading text-left"><i class="icon-clipboard"></i> {{ 'Details'|trans }} :</h3>\n\
                                        <ul class="nav nav-list text-left">\n\
                                        <li><i class="icon-user-3"></i> {{ 'Account created at'|trans }} : '+response['created_at']+'</li>'+response['company']+response['location']+response['email']+response['blog']+'\n\
                                        </ul>\n\
                                        <hr><h3 class="media-heading text-left"><i class="icon-share-2"></i> {{ 'Social'|trans }} :</h3>\n\
                                        <ul class="nav nav-list text-left"><li><i class="github-untitled-24"></i> {{ 'Number of follower'|trans }} : '+response['followers']+'</li>\n\
                                        <li><i class="github-untitled-28"></i> {{ 'Number of following'|trans }} : '+response['following']+'</li></ul>\n\
                                        <hr><h3 class="text-left"><i class="icon-stats-2"></i> {{ 'Statistics'|trans }}</h3>\n\
                                        <ul class="nav nav-list text-left">\n\
                                        <li><i class="github-untitled-160"></i> {{ 'Repositories'|trans }} : '+response['public_repos']+'</li>\n\
                                        <li><i class="icon-code"></i> {{ 'Gists'|trans }} : '+response['public_gists']+'</li>\n\
                                        </ul><hr><a class="btn" href="'+response['html_url']+'" target="_blank"><i class="icon-github-5"></i> {{ 'See on Github'|trans }}</a>').hide().slideDown('slow');
        },
        complete: function() {        
        getlimit();
        setTimeout(function () {jQuery('#app-bar').animate({'bottom': '+0px'},400);},1000);
        },
        error: function(x,t,m) {
            if ( t === 'timeout') {
                $('#error').empty();
                $('#error').append('<strong>{{ 'Error'|trans }}</strong> : {{ 'The request failed because the remote server took too long to respond'|trans }}');
                $('.alert').removeClass('hide');
                getlimit();
            } else {
               $('#error').empty();
               $('#error').append('<strong>'+t+'</strong> : '+m+x+'');
               $('.alert').removeClass('hide');
               getlimit();
            }
        }
    });
}
function getactivities() {
    $("#progressouter").removeClass("hide");
    $('#progressouter h3').text('{{ 'loading data ...'|trans }}');
    $.ajax({
        type: 'POST',
        dataType: 'json',
        url: '{{ path('activities_ajax', {'id': 0}) }}',
        data: 'id=' + profil, 
        timeout: 20000,
        success: function(response) {
            for(var i=0;i<response.length;i++) {
                $("#progress").css('width',(i*100/i)+'%');                
                setTimeout(function () {
                    $('#progressouter h3').text(i*100/i+'%');
                },100);
                var obj = response[i];
                $('#data-activities').append('<div class="listview-item bg-color-orange activity" data-actid="'+obj['actid']+'" data-createdat="'+obj['created_at']+'" data-login="'+obj['login']+'" data-avatar="'+obj['avatar']+'" data-filescount="'+obj['filescount']+'">\n\
                                              <div class="pull-left" href="#"><h1 class="pull-left"><i class="github-untitled-52"></i></h1></div>\n\
                                              <div class="listview-item-body">\n\
                                              <h4 class="listview-item-heading"><strong>{{ 'Action'|trans }} :</strong> '+obj['type']+'</h4>\n\
                                              <p class="two-lines"><strong>{{ 'repo'|trans }} : </strong>'+obj['repo']+'<br />\n\
                                              </p></div></div>').hide().fadeIn(1000);
            }
            if ( response.length === 0 ) {$("#progress").css('width','100%');$('#data-activities').append('<div class="alert alert-info text-center"><strong>{{ 'No result for'|trans }} {{profil_github_name}}</strong></div>').hide().fadeIn(1000);}
        },
        complete: function() {
        activitystatus = true;        
        getlimit();
        },
        error: function(t,m) {
            if ( t === 'timeout') {
                $('#error').empty();
                $('#error').append('<strong>{{ 'Error'|trans }}</strong> : {{ 'The request failed because the remote server took too long to respond'|trans }}');
                $('.alert').removeClass('hide');
                getlimit();
            } else {
               $('#error').append('<strong>'+t+'</strong> : '+m+'');
               $('.alert').removeClass('hide');
               getlimit();
            }
        }
    });
}
function getrepositories() {
    $("#progressouter").removeClass("hide");
    $('#progressouter h3').text('{{ 'loading data ...'|trans }}');
    $.ajax({
        type: 'POST',
        dataType: 'json',
        url: '{{ path('repositories_ajax', {'id': 0}) }}',
        data: 'id=' + profil,
        timeout: 10000,
        success: function(response) {
            for(var i=0;i<response.length; i++) {
                if(response.length === 1 || response.length === 0){
                    $("#progress").css('width','100%');
                }else{
                    $("#progress").css('width',(i*100/i)+'%'); 
                }               
                setTimeout(function () {
                    $('#progressouter h3').text(i*100/i+'%');
                },100);
                var obj = response[i];
                $('#data-repositories').append('<div class="listview-item bg-color-blue repositories" data-id="'+obj['id']+'" data-name="'+obj['name']+'" data-fullname="'+obj['full_name']+'" data-masterbranch="'+obj['master_branch']+'" data-defaultbranch="'+obj['default_branch']+'" data-owner="'+obj['owner']+'" data-avatar="'+obj['avatar']+'" data-homepage="'+obj['homepage']+'" data-language="'+obj['language']+'" data-pushedat="'+obj['pushed_at']+'" data-createdat="'+obj['created_at']+'" data-updatedat="'+obj['updated_at']+'" data-watcherscount="'+obj['watchers_count']+'" data-forkscount="'+obj['forks_count']+'" data-openissuescount="'+obj['open_issues_count']+'">\n\
                                                <div class="pull-left" href="#"><h1 class="pull-left"><i class="github-untitled-160"></i></h1></div>\n\
                                                <div class="listview-item-body"><h4 class="text-left">'+obj['name']+'</h4></div></div>').hide().fadeIn(1000);
            }
        if ( response.length === 0 ) {$("#progress").css('width','100%');$('#data-repositories').append('<div class="alert alert-info text-center"><strong>{{ 'No result for'|trans }} {{profil_github_name}}</strong></div>').hide().fadeIn(1000);}
        },
        complete: function() {
        repositorystatus = true;        
        getlimit();
        },
        error: function(x,t,m) {
            if ( t === 'timeout') {
                $('#error').empty();
                $('#error').append('<strong>{{ 'Error'|trans }}</strong> : {{ 'The request failed because the remote server took too long to respond'|trans }}');
                $('.alert').removeClass('hide');
                getlimit();
            } else {
               $('#error').append('<strong>'+t+'</strong> : '+m+x+'');
               $('.alert').removeClass('hide');
               getlimit();
            }
        }
    });
}
function getwatched() {
    $("#progressouter").removeClass("hide");
    $('#progressouter h3').text('{{ 'loading data ...'|trans }}');
    $.ajax({
        type: 'POST',
        dataType: 'json',
        url: '{{ path('watched_ajax', {'id': 0}) }}',
        data: 'id=' + profil,           
        timeout: 10000,       
        success: function(response) {            
            for(var i=0;i<response.length;i++) {                
                $("#progress").css('width',(i*100/i)+'%');  
                setTimeout(function () {
                    $('#progressouter h3').text(i*100/i+'%');
                },100);
                var obj = response[i];                
                $('#starred-list').append('<div class="listview-item watched" data-name="'+obj['name']+'" data-fullname="'+obj['fullname']+'" data-owner="'+obj['owner']+'" data-createdat="'+obj['created_at']+'" data-updatedat="'+obj['updated_at']+'" data-pushedat="'+obj['pushed_at']+'" data-avatar='+obj['avatar']+' data-description="'+obj['description'] +'" data-langage="'+obj['language']+'" data-fork="'+obj['forks']+'" data-watchers="'+obj['watchers']+'" data-link="'+obj['html_url']+'" style="background-color:#377C89;">\n\
                                           <div class="pull-left" href="#">\n\
                                           <img class="listview-item-object" alt="avatar" src="'+obj['avatar']+'" style="height:90px;width:90px;" />\n\
                                           </div>\n\
                                           <div class="listview-item-body">\n\
                                           <h4 class="listview-item-heading">'+obj['name']+'</h4></div></div>').hide().fadeIn(1000);
            }
            if ( response.length === 0 ) {$("#progress").css('width','100%');$('#starred-list').append('<div class="alert alert-info text-center"><strong>{{ 'No result for'|trans }} {{profil_github_name}}</strong></div>').hide().fadeIn(1000);}
        },
        complete: function() {
        watchedstatus = true;       
        getlimit();             
        },
        error: function(x,t,m) {
            if ( t === 'timeout') {
                $('#error').empty();
                $('#error').append('<strong>{{ 'Error'|trans }}</strong> : {{ 'The request failed because the remote server took too long to respond'|trans }}');
                $('.alert').removeClass('hide');
                getlimit();  
            } else {
               $('#error').append('<strong>'+t+'</strong> : '+m+x+'');
               $('.alert').removeClass('hide');
               getlimit();  
            }
        }
    });
}
function getfollowing() {
    $("#progressouter").removeClass("hide"); 
    $('#progressouter h3').text('{{ 'loading data ...'|trans }}');    
    $.ajax({
        type: 'POST',
        dataType: 'json',
        url: '{{ path('following_ajax', {'id': 0}) }}',
        data: 'id=' + profil,        
        timeout: 10000,
        success: function(response) {
            for(var i=0;i<response.length;i++) {                
                $("#progress").css('width',(i*100/i)+'%');                
                setTimeout(function () {
                    $('#progressouter h3').text(i*100/i+'%');
                },100);
                var obj = response[i];
                $('#following-list').append('<div class="listview-item following" data-login="'+obj['login']+'" style="background-color:#377C89;">\n\
                                           <div class="pull-left" href="#">\n\
                                           <img class="listview-item-object" src="'+obj['avatar']+'" style="height:90px;width:90px;">\n\
                                           </div>\n\
                                           <div class="listview-item-body">\n\
                                           <h4 class="listview-item-heading">'+obj['login']+'</h4></div></div>').hide().fadeIn(1000);            
            }
            if ( response.length === 0 ) {$("#progress").css('width','100%');$('#following-list').append('<div class="alert alert-info text-center"><strong>{{ 'No result for'|trans }} {{profil_github_name}}</strong></div>').hide().fadeIn(1000);}
        },
        complete: function() {
        followingstatus = true;        
        getlimit();
        },
        error: function(x,t,m) {
            if ( t === 'timeout') {
                $('#error').empty();
                $('#error').append('<strong>{{ 'Error'|trans }}</strong> : {{ 'The request failed because the remote server took too long to respond'|trans }}');
                $('.alert').removeClass('hide');
                getlimit();
            } else {
               $('#error').append('<strong>'+t+'</strong> : '+m+x+'');
               $('.alert').removeClass('hide');
               getlimit();
            }
        }
    });
}
function getfollowers() {
    $("#progressouter").removeClass("hide"); 
    $('#progressouter h3').text('{{ 'loading data ...'|trans }}');    
    $.ajax({
        type: 'POST',
        dataType: 'json',
        url: '{{ path('followers_ajax', {'id': 0}) }}',
        data: 'id=' + profil,       
        timeout: 5000,
        success: function(response) {
            for(var i=0;i<response.length;i++) {
                $("#progress").css('width',(i*100/i)+'%');                
                setTimeout(function () {
                    $('#progressouter h3').text(i*100/i+'%');
                },100);
                var obj = response[i];
                $('#followers-list').append('<div class="listview-item followers" data-login="'+obj['login']+'" style="background-color:#377C89;">\n\
                                           <div class="pull-left" href="#">\n\
                                           <img class="listview-item-object" src="'+obj['avatar']+'" style="height:90px;width:90px;">\n\
                                           </div>\n\
                                           <div class="listview-item-body">\n\
                                           <h4 class="listview-item-heading">'+obj['login']+'</h4></div></div>').css('background-color','transparent').hide().fadeIn(1000);            
            }
            if ( response.length === 0 ) {$("#progress").css('width','100%');$('#followers-list').append('<div class="alert alert-info text-center"><strong>{{ 'No result for'|trans }} {{profil_github_name}}</strong></div>').hide().fadeIn(1000);}
        },
        complete: function() {
        followersstatus = true;        
        getlimit();
        },
        error: function(t,m) {
            if ( t === 'timeout') {
                $('#error').empty();
                $('#error').append('<strong>{{ 'Error'|trans }}</strong> : {{ 'The request failed because the remote server took too long to respond'|trans }}');
                $('.alert').removeClass('hide');
                getlimit();
            } else {
               $('#error').append('<strong>'+t+'</strong> : '+m+'');
               $('.alert').removeClass('hide');
               getlimit();
            }
        }
    });
}
function getgists() {
    $("#progressouter").removeClass("hide");    
    $('#progressouter h3').text('{{ 'loading data ...'|trans }}');
    $('#gistdetail').hide();
    $.ajax({
        type: 'POST',
        dataType: 'json',
        url: '{{ path('gists_ajax', {'id': 0}) }}',
        data: 'id=' + profil,
        timeout: 10000,
        success: function(response) {
            for(var i=0;i<response.length;i++) {
                $("#progress").css('width',(i*100/i)+'%');                
                setTimeout(function () {
                    $('#progressouter h3').text(i*100/i+'%');
                },100);
                if(i>0)$('#gistdetail').show();
                var obj = response[i];
                $('#gists-list').append('<div id="'+obj['id']+'" class="listview-item gistcolor bg-color-purple">\n\
                                           <div class="pull-left" href="#">\n\
                                           <img class="listview-item-object" src="'+obj['avatar']+'">\n\
                                           </div>\n\
                                           <div class="listview-item-body">\n\
                                           <h4 class="listview-item-heading">'+obj['id']+'</h4>\n\
                                           <h5 class="listview-item-subheading">'+obj['created_at']+'</h5>\n\
                                           </div></div>').css('background-color','transparent').hide().fadeIn(1000);            
            }
            if ( response.length === 0 ) {$('#gistresult').hide();$("#progress").css('width','100%');$('#gistresult').append('<div class="alert alert-warning text-center"><strong>{{ 'No result for'|trans }} {{profil_github_name}}</strong></div>').hide().fadeIn(1000);}
        },
        complete: function() {
        gistliststatus = true;        
        getlimit();        
        },
        error: function(t,m) {
            if ( t === 'timeout') {
                $('#error').empty();
                $('#error').append('<strong>{{ 'Error'|trans }}</strong> : {{ 'The request failed because the remote server took too long to respond'|trans }}');
                $('.alert').removeClass('hide');
                getlimit();
            } else {
               $('#error').append('<strong>'+t+'</strong> : '+m+'');
               $('.alert').removeClass('hide');
               getlimit();
            }
        }
    });
}
function getGistInfo(gist) {
    $("#progressouter").removeClass("hide");    
    $('#progressouter h3').text('{{ 'loading data ...'|trans }}');
    $.ajax({
        type: 'POST',
        dataType: 'json',
        url: '{{ path('gist_ajax', {'id': 0}) }}',
        data: 'id=' + gist,
        timeout: 10000,
        success: function(response) {
             for(var i=0;i<response.length;i++) {
                if( i > 1) {
                $("#progress").css('width',(i*100/i)+'%');
                }else{
                $("#progress").css('width','100%');
                }
                setTimeout(function () {
                    $('#progressouter h3').text(i*100/i+'%');
                },100);
                var obj = response[i];
                for(var key in obj){
                   if(key === 'filename') {
                   $('#gistdetail').append('<h2 id="file'+i+'"><strong>'+obj["filename"]+'</strong><small class="pull-right">{{ 'Language'|trans }} : '+obj["language"]+'</small></h2>').hide().fadeIn(1000);
                   }
                   if(key === 'content') {
                   $('#gistdetail').append('<h3>{{ 'Code'|trans }}</h3><div id="code'+i+'">'+obj[key]+'</div><br /><a href="#file'+i+'" id="'+i+'" class="btn btn-inverse pull-left fullcode"><i class="icon-arrow-down"></i>{{ 'Extend the code'|trans }}</a><a href="'+obj["raw_url"]+'" target="_blank" class="btn btn-info pull-right"><i class="icon-github"></i> {{'See on Github'|trans }}</a><br /><hr>').hide().fadeIn(1000);
                   }
                }
            }
        },
        complete: function() {        
        getlimit();
        },
        error: function(t,m) {
            if ( t === 'timeout') {
                $('#error').empty();
                $('#error').append('<strong>{{ 'Error'|trans }}</strong> : {{ 'The request failed because the remote server took too long to respond'|trans }}');
                $('.alert').removeClass('hide');
                getlimit();
            } else {
               $('#error').append('<strong>'+t+'</strong> : '+m+'');
               $('.alert').removeClass('hide');
               getlimit();
            }
        }
    });
}
$(document).on("click", ".activity", function() {
    $('.activity').removeClass('selected');
    $(this).addClass('selected');
    $('#data-activityid').empty();
    
    $('#data-activityid').append('<h2 class="text-left"><i class="icon-history"></i> Détails :</h2><hr>\n\
                                  <h2 class="pull-left"><i class="icon-user"></i>'+$(this).data('login')+'<br /><small class="muted">'+$(this).data('actid')+'</small></h2>\n\
                                  <img class="pull-right" src="'+$(this).data('avatar')+'" alt="avatar" style="height:60px;width:60px;"><div class="clearfix"></div><hr>\n\
                                  <h2 class="text-left"><i class="icon-chart-3"></i> {{ 'Statistics'|trans }} :</h2>\n\
                                  <ul class="nav nav-list text-left">\n\
                                  <li><i class="icon-calendar-alt-stroke"></i> {{ 'Created at'|trans }} : '+$(this).data('createdat')+'</li>\n\
                                  <li><i class="icon-file"></i> {{ 'Number of files'|trans }} : '+$(this).data('filescount')+'</li>\n\
                                  </ul>').hide().slideDown('slow');    
    getActivity(profil,$(this).data('actid'));    
});
$(document).on("click", ".repositories", function() {
    $('.repositories').removeClass('selected');
    $(this).addClass('selected');
    $('#data-repository').empty();
    $('#data-repository').append('<h2 class="pull-left"><strong>'+$(this).data('owner')+'</h2><img style="height:90px;width:90px;" class="pull-right img-polaroid" src="'+$(this).data('avatar')+'" alt="avatar">\n\
                                  <div class="clearfix"></div><hr><h2>'+$(this).data('name')+'<br /><small>'+$(this).data('fullname')+'</small></h2><hr>\n\
                                  <h3 class="media-heading text-left"><i class="icon-clipboard"></i> {{ 'Details'|trans }} :</h3>\n\
                                  <ul class="nav nav-list text-left">\n\
                                  <li><i class="icon-flow-branch"></i> Master branch : '+$(this).data('masterbranch')+'</li>\n\
                                  <li><i class="icon-flow-cascade"></i> Default branch : '+$(this).data('defaultbranch')+'</li>\n\
                                  <li><i class="icon-code"></i> {{ 'Language'|trans }} : '+$(this).data('language')+'</li>\n\
                                  <li><i class="icon-home"></i> {{ 'Homepage'|trans }} : <a href="'+$(this).data('homepage')+'" target="_blank" >'+$(this).data('homepage')+'</a></li>\n\
                                  </ul><hr>\n\
                                  <h3 class="text-left"><i class="icon-stats-2"></i> {{ 'Statistics'|trans }}</h3>\n\
                                  <ul class="nav nav-list text-left">\n\
                                  <li><i class="github-untitled-5"></i> {{ 'created at'|trans }} : '+$(this).data('createdat')+'</li>\n\
                                  <li><i class="icon-spin-alt"></i> {{ 'updtated at'|trans }} : '+$(this).data('updatedat')+'</li>\n\
                                  <li><i class="icon-upload-6"></i> {{ 'Last push'|trans }} : '+$(this).data('pushedat')+'</li><li class="divider"></li>\n\
                                  <li><i class="icon-star"></i> {{ 'starred'|trans }} : '+$(this).data('watcherscount')+'</li>\n\
                                  <li><i class="icon-flow-branch"></i> {{ 'forks'|trans }} : '+$(this).data('forkscount')+'</li>\n\
                                  <li><i class="icon-notification"></i> {{ 'issues'|trans }} : '+$(this).data('openissuescount')+'</li></ul>').hide().slideDown('slow');


});
$(document).on("click", ".watched", function() {
    $('.watched').removeClass('selected');
    $('#rightprofilinfo').hide();
    $('#rightprofildata').empty();
    $(this).addClass('selected');
    $('#rightprofildata').append('<h2 class="pull-left"><strong>'+$(this).data('owner')+'</h2><img style="height:90px;width:90px;" class="pull-right img-polaroid" src="'+$(this).data('avatar')+'" alt="avatar">\n\
                                  <div class="clearfix"></div><hr><h2>'+$(this).data('name')+'<br /><small>'+$(this).data('fullname')+'</small></h2><hr>');
                                  if($(this).data('description') !== '') {
                                  $('#rightprofildata').append('<h3 class="media-heading text-left"><i class="icon-info-6"></i> {{ 'Description'|trans }}</h3>\n\
                                  <br /><blockquote class="text-left">'+$(this).data('description')+'</blockquote><hr>');
                                  }
                                  $('#rightprofildata').append('<h3 class="media-heading text-left"><i class="icon-calendar-5"></i> {{ 'Dates'|trans }} :</h3>\n\
                                  <ul class="nav nav-list text-left">\n\
                                  <li><i class="github-untitled-5"></i> {{ 'Created at'|trans }} : '+$(this).data('createdat')+'</li>\n\
                                  <li><i class="icon-spin-alt"></i> {{ 'Updated at'|trans }} : '+$(this).data('updatedat')+'</li>\n\
                                  <li><i class="icon-upload-6"></i> {{ 'Last push'|trans }} : '+$(this).data('pushedat')+'</li></ul><hr>\n\
                                  <h3 class="text-left"><i class="icon-stats-2"></i> {{ 'Statistics'|trans }}</h3>\n\
                                  <ul class="nav nav-list text-left">\n\
                                  <li><i class="icon-fork"></i> {{ 'forks'|trans }} : ' +$(this).data('fork')+'</li>\n\
                                  <li><i class="icon-star"></i> {{ 'starred'|trans }} : '+$(this).data('watchers')+'</li>\n\
                                  <li><i class="icon-code"></i> {{ 'Language'|trans }} : '+$(this).data('langage')+'</li>\n\
                                  </ul><hr><a class="btn" href="'+$(this).data('link')+'" target="_blank"><i class="icon-github-5"></i> {{ 'See on Github'|trans }}</a>').hide().slideDown('slow');
});
$(document).on("click", ".following", function() {
    $('.following').removeClass('selected');
    $('#rightprofilinfo').hide();
    $('#rightprofildata').empty();
    $(this).addClass('selected');    
    getdevprofil($(this).data('login'));
});
$(document).on("click", ".followers", function() {
    $('.followers').removeClass('selected');
    $('#rightprofilinfo').hide();
    $('#rightprofildata').empty();
    $(this).addClass('selected');    
    getdevprofil($(this).data('login'));
});
$(document).on("click", ".gistcolor", function(e) {
    $('.gistcolor').removeClass('bg-color-yellow selected').addClass('bg-color-purple').css('color','#fff');
    $(this).removeClass('bg-color-purple').addClass('bg-color-yellow selected').css('color','#000');
    $("#gistdetail").empty();
    getGistInfo($(this).attr('id'));
});
$(document).on("click", ".fullcode", function(e) {
var id= $(this).attr('id');
if ($('#code'+id).children().hasClass('pre-scrollable-fox'))
    {
        $(this).html('<i class="icon-arrow-up"></i>Replier le code');
        $('#code'+id).children().removeClass('pre-scrollable-fox').hide().fadeIn(500);
    }else{
        $(this).html('<i class="icon-arrow-down"></i>Deplier le code');
        $('#code'+id).children().addClass('pre-scrollable-fox').css('overflow-x','hidden').hide().fadeIn(500);
    }
});
</script>
{% endblock %}